@{
    ViewData["Title"] = "Digitalna Mapa";
}

<h1 class="text-center mb-4" style="font-family: 'Cinzel', serif; font-weight: 700;">
    Dobrodošli na Lux Aurelius<br>
    <span style="font-family: 'Times New Roman', serif; font-weight: 400;">festum culturae romanae</span><br>
    Sirmium MMXXV
</h1>
    
<!-- Filter controls -->
<div class="d-flex justify-content-center mb-3 flex-wrap">
    <button type="button" class="btn btn-primary m-1 filter-btn active" data-type="All">Sve</button>
    <button type="button" class="btn btn-outline-primary m-1 filter-btn" data-type="Dešavanja">Dešavanja</button>
    <button type="button" class="btn btn-outline-primary m-1 filter-btn" data-type="Servisi">Servisi</button>
</div>

<!-- Vraćeno unutar .container div-a, ali sada je ovaj container uklonjen iz Map.cshtml -->
<div id="map" class="w-100 h-100"></div>
<div class="legend">
    <div class="legend-title text-center mb-3">LEGENDA</div>
    <div class="d-flex justify-content-center gap-4 flex-wrap">
        <div class="legend-palata legend-item d-inline-block text-center" style="cursor:pointer; min-width: 80px;">
            <img src="/images/palata.png" alt="Carska palata" style="width: 40px; height: 40px;">
            <div class="mt-1">Carska palata</div>
        </div>
        <div class="legend-park legend-item d-inline-block text-center" style="cursor:pointer; min-width: 80px;">
            <img src="/images/park.png" alt="Gradski park" style="width: 40px; height: 40px;">
            <div class="mt-1">Gradski park</div>
        </div>
        <div class="legend-muzej legend-item d-inline-block text-center" style="cursor:pointer; min-width: 80px;">
            <img src="/images/muzejsrema.png" alt="Muzej Srema" style="width: 40px; height: 40px;">
            <div class="mt-1">Muzej Srema</div>
        </div>
        <div class="legend-lapidarijum legend-item d-inline-block text-center" style="cursor:pointer; min-width: 80px;">
            <img src="/images/lapidarijum.png" alt="Lapidarijum" style="width: 40px; height: 40px;">
            <div class="mt-1">Lapidarijum</div>
        </div>
        <div class="legend-biblioteka legend-item d-inline-block text-center" style="cursor:pointer; min-width: 80px;">
            <img src="/images/biblioteka.png" alt="Gradska Biblioteka" style="width: 40px; height: 40px;">
            <div class="mt-1">Biblioteka</div>
        </div>
        <div class="legend-zitnitrg legend-item d-inline-block text-center" style="cursor:pointer; min-width: 80px;">
            <img src="/images/zitnitrg.png" alt="Žitni Trg" style="width: 40px; height: 40px;">
            <div class="mt-1">Žitni Trg</div>
        </div>
        <div class="legend-pozoriste legend-item d-inline-block text-center" style="cursor:pointer; min-width: 80px;">
            <img src="/images/pozoriste.png" alt="Gradsko Pozorište" style="width: 40px; height: 40px;">
            <div class="mt-1">Pozorište</div>
        </div>
        <div class="legend-galerija legend-item d-inline-block text-center" style="cursor:pointer; min-width: 80px;">
            <img src="/images/galerija.png" alt="Gradska Galerija" style="width: 40px; height: 40px;">
            <div class="mt-1">Galerija</div>
        </div>
        <div class="legend-moskva legend-item d-inline-block text-center" style="cursor:pointer; min-width: 80px;">
            <img src="/images/kafanamoskva.png" alt="Kafana Moskva" style="width: 40px; height: 40px;">
            <div class="mt-1">Kafana Moskva</div>
        </div>
        <div class="legend-arhiv-srema legend-item d-inline-block text-center" style="cursor:pointer; min-width: 80px;">
            <img src="/images/arhivsrema.png" alt="Arhiv Srema" style="width: 40px; height: 40px;">
            <div class="mt-1">Arhiv Srema</div>
        </div>
        <div class="legend-kamp legend-item d-inline-block text-center" style="cursor:pointer; min-width: 80px;">
            <img src="/images/kamp.png" alt="Rimski Legionarski Kamp" style="width: 40px; height: 40px;">
            <div class="mt-1">Rimski Kamp</div>
        </div>
        <div class="legend-bazilika legend-item d-inline-block text-center" style="cursor:pointer; min-width: 80px;">
            <img src="/images/bazilika.png" alt="Bazilika Svetog Stefana" style="width: 40px; height: 40px;">
            <div class="mt-1">Bazilika</div>
        </div>
        <div class="legend-turisticka legend-item d-inline-block text-center" style="cursor:pointer; min-width: 80px;">
            <img src="/images/turistickaorganizacija.png" alt="Turistička Organizacija" style="width: 40px; height: 40px;">
            <div class="mt-1">Turistička Org.</div>
        </div>
        <div class="legend-toalet legend-item d-inline-block text-center" style="cursor:pointer; min-width: 80px;">
            <img src="/images/wc.png" alt="Toalet" style="width: 40px; height: 40px;">
            <div class="mt-1">Toalet</div>
        </div>
        <div class="legend-voda legend-item d-inline-block text-center" style="cursor:pointer; min-width: 80px;">
            <img src="/images/voda.png" alt="Voda" style="width: 40px; height: 40px;">
            <div class="mt-1">Voda</div>
        </div>
        <div class="legend-pomoc legend-item d-inline-block text-center" style="cursor:pointer; min-width: 80px;">
            <img src="/images/pomoc.png" alt="Prva Pomoć" style="width: 40px; height: 40px;">
            <div class="mt-1">Prva Pomoć</div>
        </div>
        <div class="legend-hrana legend-item d-inline-block text-center" style="cursor:pointer; min-width: 80px;">
            <img src="/images/hrana.png" alt="Hrana" style="width: 40px; height: 40px;">
            <div class="mt-1">Hrana</div>
        </div>
        <div class="legend-bazar legend-item d-inline-block text-center" style="cursor:pointer; min-width: 80px;">
            <img src="/images/rimskibazar.png" alt="Rimski Bazar" style="width: 40px; height: 40px;">
            <div class="mt-1">Rimski Bazar</div>
        </div>
        <div class="legend-lampioni legend-item d-inline-block text-center" style="cursor:pointer; min-width: 80px;">
            <img src="/images/lampioni.png" alt="Savski kej" style="width: 40px; height: 40px;">
            <div class="mt-1">Savski kej</div>
        </div>
        <div class="legend-parking legend-item d-inline-block text-center" style="cursor:pointer; min-width: 80px;">
            <img src="/images/parking.png" alt="Parking" style="width: 40px; height: 40px;">
            <div class="mt-1">Parking</div>
        </div>
        <div class="legend-kedarbar legend-item d-inline-block text-center" style="cursor:pointer; min-width: 80px;">
            <img src="/images/kedarbar.png" alt="Kedar Bar" style="width: 40px; height: 40px;">
            <div class="mt-1">Kedar Bar</div>
        </div>
    </div>
</div>

<style>
    #map {
        width: 100%;
        height: 65vh;
        min-height: 350px;
        max-height: 700px;
        margin-bottom: 0;
        border-radius: 10px;
        border: 1px solid #444;
        box-shadow: 0 2px 8px #000a;
    }
    .legend-container {
        background: transparent;
        color: #e0c97f;
    }
    .legend-item {
        transition: transform 0.2s ease;
    }
    .legend-item:hover {
        transform: scale(1.05);
    }
    .legend-item img {
        display: block;
        margin: 0 auto;
    }
    .legend-item div {
        font-size: 0.9em;
        color: #DAA520;
        text-align: center;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        max-width: 100%;
    }
</style>

@section Scripts {
    <script>
        // Definiranje granica slike (visina x širina u pikselima)
        var imageBounds = [[0, 0], [1200, 1800]]; // [y1, x1], [y2, x2]

        // Inicijalizacija mape - prilagođeno za imageOverlay
        var map = L.map('map', {
            crs: L.CRS.Simple,
            minZoom: -3, // Omogući veći odzum za prikaz cijele slike
            maxZoom: 3,  // Omogući veći zum za detalje
            zoomSnap: 0.1,
            scrollWheelZoom: true,
            attributionControl: false,
            bounds: imageBounds // Definiramo granice karte na temelju slike
        });

        // Dodavanje crtane mape kao imageOverlay
        L.imageOverlay('/images/mapa.jpg', imageBounds).addTo(map);

        // KLJUČNO: Odmah invalidirati veličinu mape nakon inicijalizacije
        map.invalidateSize();

        // KLJUČNO: Podesite view da odgovara granicama slike i ograničite pomicanje
        map.fitBounds(imageBounds);
        map.setMaxBounds(imageBounds); // Ograniči pomicanje mape unutar granica slike

        var markers = L.layerGroup().addTo(map);

        // Definiranje ikona za različite tipove
        // const icons = {
        //     Stage: L.icon({
        //         iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-red.png',
        //         shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png',
        //         iconSize: [25, 41],
        //         iconAnchor: [12, 41],
        //         popupAnchor: [1, -34],
        //         shadowSize: [41, 41]
        //     }),
        //     Food: L.icon({
        //         iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-green.png',
        //         shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png',
        //         iconSize: [25, 41],
        //         iconAnchor: [12, 41],
        //         popupAnchor: [1, -34],
        //         shadowSize: [41, 41]
        //     }),
        //     WC: L.icon({
        //         iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-blue.png',
        //         shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png',
        //         iconSize: [25, 41],
        //         iconAnchor: [12, 41],
        //         popupAnchor: [1, -34],
        //         shadowSize: [41, 41]
        //     }),
        //     Kids: L.icon({
        //         iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-yellow.png',
        //         shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png',
        //         iconSize: [25, 41],
        //         iconAnchor: [12, 41],
        //         popupAnchor: [1, -34],
        //         shadowSize: [41, 41]
        //     }),
        //     Other: L.icon({
        //         iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-grey.png',
        //         shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png',
        //         iconSize: [25, 41],
        //         iconAnchor: [12, 41],
        //         popupAnchor: [1, -34],
        //         shadowSize: [41, 41]
        //     })
        // };

        // Primjer podataka za Sremska Mitrovica (sada s x, y pikselnim koordinatama i geografskim koordinatama za Google Maps)
        // var samplePOIs = [
        //     {
        //         name: "Carska Palata",
        //         description: "Arheološko nalazište",
        //         type: "Stage",
        //         x: 255, y: 283, // AŽURIRANO PREMA VAŠOJ SLICI
        //         latitude: 44.9780, longitude: 19.6105, 
        //         openTime: "09:00",
        //         closeTime: "18:00"
        //     },
        //     {
        //         name: "Rimske Ruševine",
        //         description: "Ostaci rimske civilizacije",
        //         type: "Other",
        //         x: 422, y: 894, // **OVO MORATE RUČNO PRILAGODITI VAŠOJ SLICI**
        //         latitude: 44.9750, longitude: 19.6090,
        //         openTime: "00:00",
        //         closeTime: "23:59"
        //     },
        //     {
        //         name: "Mehana (Hrana)",
        //         description: "Mjesto za jelo i piće",
        //         type: "Food",
        //         x: 1268, y: 618, // **OVO MORATE RUČNO PRILAGODITI VAŠOJ SLICI**
        //         latitude: 44.9760, longitude: 19.6150,
        //         openTime: "10:00",
        //         closeTime: "22:00"
        //     },
        //     {
        //         name: "Bazilika",
        //         description: "Starokršćanska bazilika",
        //         type: "Other",
        //         x: 1238, y: 972, // **OVO MORATE RUČNO PRILAGODITI VAŠOJ SLICI**
        //         latitude: 44.9720, longitude: 19.6160,
        //         openTime: "09:00",
        //         closeTime: "17:00"
        //     },
        //     {
        //         name: "Rijeka Sava - Pristanište",
        //         description: "Mjesto za odmor uz rijeku",
        //         type: "Other",
        //         x: 1000, y: 340, // **OVO MORATE RUČNO PRILAGODITI VAŠOJ SLICI**
        //         latitude: 44.9700, longitude: 19.6200,
        //         openTime: "00:00",
        //         closeTime: "23:59"
        //     }
        // ];

        // // Funkcija za dodavanje markera
        // function addMarker(poi) {
        //     // Koristimo unproject za mapiranje pikselnih koordinata na Leaflet koordinate
        //     // Y-koordinata se invertira jer je Leafletov L.CRS.Simple origin u donjem lijevom kutu, a imageOverlay u gornjem lijevom.
        //     var marker = L.marker(map.unproject([poi.x, 1024 - poi.y]), { icon: icons[poi.type] })
        //         .bindPopup(`
        //             <h5>${poi.name}</h5>
        //             <p>${poi.description}</p>
        //             <p><strong>Tip:</strong> ${poi.type}</p>
        //             ${poi.openTime && poi.closeTime ? `<p><strong>Radno vrijeme:</strong> ${poi.openTime} - ${poi.closeTime}</p>` : ''}
        //             <br/>
        //             <a href="https://www.google.com/maps/search/?api=1&query=${poi.latitude},${poi.longitude}" target="_blank" class="btn btn-sm btn-info">Otvori u Google mapama</a>
        //         `);
        //     marker.poiType = poi.type; // Dodajemo tip za filtriranje
        //     markers.addLayer(marker);
        // }

        // // Dodavanje svih POI-jeva na mapu
        // samplePOIs.forEach(addMarker);

        // // Implementacija filtriranja
        // document.querySelectorAll('.filter-btn').forEach(button => {
        //     button.addEventListener('click', function() {
        //         // Ukloni aktivnu klasu sa svih gumba
        //         document.querySelectorAll('.filter-btn').forEach(btn => {
        //             btn.classList.remove('active');
        //             btn.classList.remove('btn-primary');
        //             btn.classList.add('btn-outline-primary');
        //         });
                
        //         // Dodaj aktivnu klasu na kliknuti gumb
        //         this.classList.add('active');
        //         this.classList.remove('btn-outline-primary');
        //         this.classList.add('btn-primary');

        //         const selectedType = this.dataset.type;
                
        //         // Filtriraj markere
        //         markers.eachLayer(marker => {
        //             if (selectedType === 'all' || marker.poiType === selectedType) {
        //                 marker.addTo(map);
        //             } else {
        //                 marker.remove();
        //             }
        //         });
        //     });
        // });

        // Prilagodba veličine mape kada se prozor promijeni
        map.on('resize', function() {
            setTimeout(function() {
                map.invalidateSize(); 
                map.fitBounds(imageBounds); // Prilagodi mapu granicama slike
            }, 100); // Kratka odgoda od 100ms
        });

        // Dodatno osigurati da se mapa inicijalizira ispravno
        map.whenReady(function() {
            setTimeout(function() {
                map.invalidateSize();
                map.fitBounds(imageBounds); // Prilagodi mapu granicama slike
            }, 100); // Kratka odgoda od 100ms
        });

    </script>
} 